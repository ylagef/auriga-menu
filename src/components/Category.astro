---
import Card from '@components/Card.astro'
import Divider from '@components/Divider.astro'
import ExtraServices from '@components/ExtraServices.astro'
import Menu from '@components/Menu.astro'
import Products from '@components/Products.astro'
import Sections from '@components/Sections.astro'
import { CategorySI } from 'src/typesSupabase'
import { getMenuByCategory, getProductsByCategory, getSectionsByCategory } from 'src/utils/supabase'

import { translations } from '../locales/translations'
export interface Props {
  category: CategorySI
}

const {
  category: { id, schedules, categoryTitle, extraServices }
} = Astro.props

// Call all getters with await and set to variables
const [products, sections, menu] = await Promise.all([
  getProductsByCategory({ categoryId: id }),
  getSectionsByCategory({ categoryId: id }),
  getMenuByCategory({ categoryId: id })
])
---

<Card>
  <h1 class="text-center">{categoryTitle}</h1>

  {
    schedules && (
      <div class="flex flex-col gap-1 py-4">
        {schedules.map((schedule) => (
          <small class="text-center">{translations.schedules[schedule]}</small>
        ))}
      </div>
    )
  }

  {extraServices && <ExtraServices extraServices={extraServices} />}

  <Divider theme="dark" />

  {sections && <Sections sections={sections} />}

  {products && <Products products={products} />}

  {menu && <Menu menu={menu} />}
</Card>
